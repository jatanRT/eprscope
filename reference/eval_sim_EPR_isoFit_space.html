<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This is an extended version of the eval_sim_EPR_isoFit, providing a broader range of the initial simulation
  parameters in order to find a more reliable simulation fit of an experimental isotropic EPR spectrum. The parameter space
  (represented by data frame/matrix and/or vector(s)) is divided into several points (see the argument N.points.space)
  where each of these points corresponds to starting values (see arguments optim.params.init +
  optim.params.init.dvary as well as lineG.content + lineG.content.dvary), which are optimized
  by the default eval_sim_EPR_isoFit setup. Because such procedure is computationally
  highly demanding, the central loop, to iterate/evaluate parameters and the corresponding EPR spectra, uses
  the {future.apply} package
  (see also the future_Map function). It enables relatively seamless application
  of parallel computing
  (please, also refer to the processing argument),
  regardless of the operating system (OS) to dramatically speed-up the entire searching for the best fit.
  In addition to graphical outputs, function also provides an animated representation
  (using the {animation} package) of the procedure progress
  by showing the evaluated EPR spectra at each point."><title>Explore the Hyperspace of Initial EPR Simulation Parameters (Searching for the Best Fit) — eval_sim_EPR_isoFit_space • eprscope</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><script src="../extra.js"></script><meta property="og:title" content="Explore the Hyperspace of Initial EPR Simulation Parameters (Searching for the Best Fit) — eval_sim_EPR_isoFit_space"><meta property="og:description" content="This is an extended version of the eval_sim_EPR_isoFit, providing a broader range of the initial simulation
  parameters in order to find a more reliable simulation fit of an experimental isotropic EPR spectrum. The parameter space
  (represented by data frame/matrix and/or vector(s)) is divided into several points (see the argument N.points.space)
  where each of these points corresponds to starting values (see arguments optim.params.init +
  optim.params.init.dvary as well as lineG.content + lineG.content.dvary), which are optimized
  by the default eval_sim_EPR_isoFit setup. Because such procedure is computationally
  highly demanding, the central loop, to iterate/evaluate parameters and the corresponding EPR spectra, uses
  the {future.apply} package
  (see also the future_Map function). It enables relatively seamless application
  of parallel computing
  (please, also refer to the processing argument),
  regardless of the operating system (OS) to dramatically speed-up the entire searching for the best fit.
  In addition to graphical outputs, function also provides an animated representation
  (using the {animation} package) of the procedure progress
  by showing the evaluated EPR spectra at each point."><!-- mathjax --><script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js">
</script><!--
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
--><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">eprscope</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.15</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/datasets.html">Package Datasets</a></li>
    <li><a class="dropdown-item" href="../articles/firstSteps.html">First Steps with R Language</a></li>
    <li><a class="dropdown-item" href="../articles/functionality.html">Basic Functionality</a></li>
    <li><a class="dropdown-item" href="../articles/introduction.html">Introduction</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jatanrt/eprscope/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Explore the Hyperspace of Initial EPR Simulation Parameters (Searching for the Best Fit)</h1>
      <small class="dont-index">Source: <a href="https://github.com/jatanrt/eprscope/blob/master/R/eval_sim_EPR_isoFit_space.R" class="external-link"><code>R/eval_sim_EPR_isoFit_space.R</code></a></small>
      <div class="d-none name"><code>eval_sim_EPR_isoFit_space.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This is an extended version of the <code><a href="eval_sim_EPR_isoFit.html">eval_sim_EPR_isoFit</a></code>, providing a broader range of the initial simulation
  parameters in order to find a more reliable simulation fit of an experimental isotropic EPR spectrum. The parameter space
  (represented by data frame/matrix and/or vector(s)) is divided into several points (see the argument <code>N.points.space</code>)
  where each of these points corresponds to starting values (see arguments <code>optim.params.init</code> +
  <code>optim.params.init.dvary</code> as well as <code>lineG.content</code> + <code>lineG.content.dvary</code>), which are optimized
  by the <strong>default</strong> <code><a href="eval_sim_EPR_isoFit.html">eval_sim_EPR_isoFit</a></code> <strong>setup</strong>. Because such procedure is computationally
  highly demanding, the central loop, to iterate/evaluate parameters and the corresponding EPR spectra, uses
  the <a href="https://future.apply.futureverse.org/" class="external-link"><code>{future.apply}</code></a> package
  (see also the <code><a href="https://future.apply.futureverse.org/reference/future_mapply.html" class="external-link">future_Map</a></code> function). It enables relatively seamless application
  of <a href="https://nceas.github.io/oss-lessons/parallel-computing-in-r/parallel-computing-in-r.html" class="external-link">parallel computing</a>
  (please, also refer to the <code>processing</code> argument),
  regardless of the operating system (OS) to dramatically speed-up the entire searching for the best fit.
  In addition to graphical outputs, function also provides an animated representation
  (using the <a href="https://yihui.org/animation/" class="external-link"><code>{animation}</code></a> package) of the procedure progress
  by showing the evaluated EPR spectra at each point.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">eval_sim_EPR_isoFit_space</span><span class="op">(</span></span>
<span>  <span class="va">data.spectr.expr</span>,</span>
<span>  <span class="va">nu.GHz</span>,</span>
<span>  B.unit <span class="op">=</span> <span class="st">"G"</span>,</span>
<span>  nuclear.system.noA <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  baseline.correct <span class="op">=</span> <span class="st">"constant"</span>,</span>
<span>  lineG.content <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  lineG.content.dvary <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lineSpecs.form <span class="op">=</span> <span class="st">"derivative"</span>,</span>
<span>  optim.method <span class="op">=</span> <span class="st">"neldermead"</span>,</span>
<span>  <span class="va">optim.params.init</span>,</span>
<span>  optim.params.init.dvary <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  Nmax.evals <span class="op">=</span> <span class="fl">256</span>,</span>
<span>  N.points.space <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  check.fit.plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  processing <span class="op">=</span> <span class="st">"sequential"</span>,</span>
<span>  animation <span class="op">=</span> <span class="st">"Fitting_of_sim_EPR"</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data-spectr-expr">data.spectr.expr<a class="anchor" aria-label="anchor" href="#arg-data-spectr-expr"></a></dt>
<dd><p>Data frame object/table, containing the experimental spectral data with the magnetic flux density
(<code>"B_mT"</code> or <code>"B_G"</code>) and the intensity (see the <code>Intensity.expr</code> argument) columns.</p></dd>


<dt id="arg-nu-ghz">nu.GHz<a class="anchor" aria-label="anchor" href="#arg-nu-ghz"></a></dt>
<dd><p>Numeric value, microwave frequency in <code>GHz</code>.</p></dd>


<dt id="arg-b-unit">B.unit<a class="anchor" aria-label="anchor" href="#arg-b-unit"></a></dt>
<dd><p>Character string, denoting the magnetic flux density unit e.g. <code>B.unit = "G"</code>
(gauss, <strong>default</strong>) or <code>B.unit = "mT"</code>/<code>"T"</code> (millitesla/tesla).</p></dd>


<dt id="arg-nuclear-system-noa">nuclear.system.noA<a class="anchor" aria-label="anchor" href="#arg-nuclear-system-noa"></a></dt>
<dd><p>List or nested list <strong>without estimated hyperfine coupling constant values</strong>,
such as <code>list("14N",1)</code> or <code>list(list("14N", 2),list("1H", 4),list("1H", 12))</code>. The \(A\)-values
are already defined as elements of the <code>optim.params.init</code> argument/vector. If the EPR spectrum
does not display any hyperfine splitting, the argument definition reads <code>nuclear.system.noA = NULL</code> (<strong>default</strong>).</p></dd>


<dt id="arg-baseline-correct">baseline.correct<a class="anchor" aria-label="anchor" href="#arg-baseline-correct"></a></dt>
<dd><p>Character string, referring to baseline correction of the simulated/fitted spectrum.
Corrections like <code>"constant"</code> (<strong>default</strong>), <code>"linear"</code> or <code>"quadratic"</code> can be applied.</p></dd>


<dt id="arg-lineg-content">lineG.content<a class="anchor" aria-label="anchor" href="#arg-lineg-content"></a></dt>
<dd><p>Numeric value between <code>0</code> and <code>1</code>, referring to content of the <em>Gaussian</em> line form.
If <code>lineG.content = 1</code> (<strong>default</strong>) it corresponds to "pure" <em>Gaussian</em> line form
and if <code>lineG.content = 0</code> it corresponds to <em>Lorentzian</em> one. The value from (0,1)
(e.g. <code>lineG.content = 0.5</code>) represents the linear combination (for the example above,
with the coefficients 0.5 and 0.5) of both line forms =&gt; so called <em>pseudo-Voigt</em>.</p></dd>


<dt id="arg-lineg-content-dvary">lineG.content.dvary<a class="anchor" aria-label="anchor" href="#arg-lineg-content-dvary"></a></dt>
<dd><p>Numeric value, corresponding to initial <strong>var</strong>iation of <code>lineG.content</code>,
(Gaussian EPR line content in the simulated EPR spectrum) provided as \(\pm\) <strong>d</strong>ifference
of the central <code>lineG.content</code> value. For example, if <code>lineG.content = 0.42</code>
and <code>lineG.content.dvary = 0.2</code>, the parameter will be varied within the range of \(0.42\pm 0.2\),
which will be divided into <code>N.points.space</code> points (like already shown for the example
in the <code>N.points.space</code> argument description). <strong>Default</strong>: <code>lineG.content.dvary = NULL</code>,
actually pointing to constant <code>lineG.value</code> throughout the space (optimization/fitting procedures).</p></dd>


<dt id="arg-linespecs-form">lineSpecs.form<a class="anchor" aria-label="anchor" href="#arg-linespecs-form"></a></dt>
<dd><p>Character string, describing either <code>"derivative"</code> (<strong>default</strong>)
or <code>"integrated"</code> (i.e. <code>"absorption"</code> which can be used as well) line form
of the analyzed EPR spectrum/data.</p></dd>


<dt id="arg-optim-method">optim.method<a class="anchor" aria-label="anchor" href="#arg-optim-method"></a></dt>
<dd><p>Character string (vector), setting the optimization method(s) gathered within
the <code><a href="optim_for_EPR_fitness.html">optim_for_EPR_fitness</a></code>. <strong>Default</strong>: <code>optim.method = "neldermead"</code>. Additionally,
several consecutive methods can be defined like <code>optim.method = c("levenmarq","neldermead")</code>, where
the best fit parameters from the previous method are used as input for the next one.</p></dd>


<dt id="arg-optim-params-init">optim.params.init<a class="anchor" aria-label="anchor" href="#arg-optim-params-init"></a></dt>
<dd><p>Numeric vector with the initial parameter guess (elements) where the <strong>first five
  elements are immutable</strong></p><ol><li><p>g-value (g-factor)</p></li>
<li><p><strong>G</strong>aussian linewidth</p></li>
<li><p><strong>L</strong>orentzian linewidth</p></li>
<li><p>baseline constant (intercept or offset)</p></li>
<li><p>intensity multiplication constant</p></li>
<li><p>baseline slope (only if <code>baseline.correct = "linear"</code> or <code>baseline.correct = "quadratic"</code>),
  if <code>baseline.correct = "constant"</code> it corresponds to the <strong>first HFCC</strong> (\(A_1\))</p></li>
<li><p>baseline quadratic coefficient (only if <code>baseline.correct = "quadratic"</code>),
  if <code>baseline.correct = "constant"</code> it corresponds to the <strong>second HFCC</strong> (\(A_2\)),
  if <code>baseline.correct = "linear"</code> it corresponds to the <strong>first HFCC</strong> (\(A_1\))</p></li>
<li><p>additional HFCC (\(A_3\)) if <code>baseline.correct = "constant"</code> or if
  <code>baseline.correct = "linear"</code> (\(A_2\)), if <code>baseline.correct = "quadratic"</code> it corresponds
  to the <strong>first HFCC</strong> (\(A_1\))</p></li>
<li><p>...additional HFCCs (\(A_k...\), each vector element is reserved only for one \(A\))</p></li>
</ol><p>DO NOT PUT ANY OF THESE PARAMETERS to <code>NULL</code>. If the lineshape is expected to be pure
  <strong>L</strong>orentzian or pure <strong>G</strong>aussian then put the corresponding vector element to <code>0</code>.</p></dd>


<dt id="arg-optim-params-init-dvary">optim.params.init.dvary<a class="anchor" aria-label="anchor" href="#arg-optim-params-init-dvary"></a></dt>
<dd><p>Numeric vector with initial <strong>var</strong>iations of the corresponding
<code>optim.params.init</code> elements in the form of <strong>d</strong>ifferences from the central <code>optim.params.init</code>
values. For example, for the aminoxyl radical we may assume <code>optim.params.init = c(2.006,4.8,4.8,0,1.4e-2,49)</code>
(see the <code>optim.params.init</code> argument definition). Thus, the <code>optim.params.init.dvary</code> could be defined
as follows: <code>c(0.002,2.0,2.0,0,1e-2,3.2)</code>, meaning that \(g = 2.006\pm 0.002\),
\(\Delta B_{\text{pp}}^{\text{G}} = 4.8\pm 2.0\,\text{G}\),
\(\Delta B_{\text{pp}}^{\text{L}} = 4.8\pm 2.0\,\text{G}\), constant baseline \(0\pm 0\), ...etc.
The user may "fix" one or more initial parameter values by putting the corresponding <code>optim.params.init.dvary</code>
element to <code>0</code>. However, this does not fix that (those) parameter(s) in a true sense. Rather, the <strong>initial</strong>
parameter <strong>value remains constant</strong> over the whole space (however, it will be optimized within
the default bound constraints anyway, see the <code><a href="eval_sim_EPR_isoFit.html">eval_sim_EPR_isoFit</a></code> documentation). If one really wants
to fix one or more parameters (which won't be optimized) an optional <code>optim.params.fix.id</code> (see also description
of the <code>...</code> argument) should be used together with <code>0</code> of the corresponding <code>optim.params.init.dvary</code>
element. For example, to fix the g-Value (i.e. it won't be optimized) of the above-described aminoxyl, one must add
<code>optim.params.fix.id = 1</code> and <code>optim.params.init.dvary = c(0,2.0,2.0,0,1e-2,3.2)</code>, like already demostrated
in the <code>Examples</code>. If the entire <code>optim.params.init</code> argument is to be "fixed" =&gt; put
<code>optim.params.init.dvary = NULL</code> (<strong>default</strong>). In all cases, the related <code>optim.params.init</code>
space will be created as a matrix or data frame (see also the <code>Value</code>/<code>init.space.df</code>) with
variables/columns corresponding to individual parameters, and observations/rows corresponding
to each <code>N.points.space</code>, dividing the parameter variation range (e.g \(g = 2.006\pm 0.002\))
into smaller spaces. Therefore, the fitting process will be performed (by the default <code><a href="eval_sim_EPR_isoFit.html">eval_sim_EPR_isoFit</a></code>
configuration) for each row of the initial data frame (<code>init.space.df</code>) together with the initial <code>lineG.content</code>
variation vector (see the description of <code>N.points.space</code> and <code>lineG.content.dvary</code> arguments).
For the <code>optim.params.init.dvary = NULL</code>, the fitting procedure is just repeated
<code>N.points.space</code>-times, with the same parameter set. Such processing might be useful to determine
the uncertainty (represented by the confidence interval) of each optimized EPR simulation parameter
by the <code><a href="eval_interval_cnfd_tVec.html">eval_interval_cnfd_tVec</a></code> for each column of the <code>optim.space.df</code> (see the <code>Value</code>).</p></dd>


<dt id="arg-nmax-evals">Nmax.evals<a class="anchor" aria-label="anchor" href="#arg-nmax-evals"></a></dt>
<dd><p>Numeric value, maximum number of function evaluations and/or iterations.
The only one method, limited by this argument, is <code><a href="https://rdrr.io/pkg/minpack.lm/man/nls.lm.html" class="external-link">nls.lm</a></code>, where
<code>Nmax.evals = 1024</code>. Higher <code>Nmax.evals</code> may extremely extend the optimization
time, therefore the <strong>default</strong> value reads <code>Nmax.evals = 512</code>. However, the <code>"pswarm"</code>
method requires at least the default or even higher values.</p></dd>


<dt id="arg-n-points-space">N.points.space<a class="anchor" aria-label="anchor" href="#arg-n-points-space"></a></dt>
<dd><p>Numeric value, identical to number of points by which the initial parameter-hyperspace
(see the <code>lineG.content.dvary</code> and/or <code>optim.params.init.dvary</code> and their corresponding
<code>lineG.content</code> as well as <code>optim.params.init</code> arguments)
is divided, in order to find the best optimized parameters for EPR simulation fit of the isotropic
experimental spectrum. <strong>Default</strong>: <code>N.points.space = 16</code>, e.g. if <code>lineG.content = 0.42</code>
and <code>lineG.content.dvary = 0.2</code>, the initial corresponding vector looks like
<code>c(0.220,0.247,0.273,0.300,0.327,...,0.567,0.593,0.620)</code>, where the length of this vector is equal
to <code>N.points.space = 16</code>.</p></dd>


<dt id="arg-check-fit-plot">check.fit.plot<a class="anchor" aria-label="anchor" href="#arg-check-fit-plot"></a></dt>
<dd><p>Logical, whether to return overlay plot with the initial simulation + the best simulation
fit + experimental spectrum (including residuals in the lower part of the plot,
<code>check.fit.plot = TRUE</code>, <strong>default</strong>) or with the following three spectra
(<code>check.fit.plot = FALSE</code>): 1. experimental, 2. the best simulated one with the baseline fit
and 3. the best simulated spectrum with the baseline fit subtracted. The latter two are offset for clarity,
within the plot.</p></dd>


<dt id="arg-processing">processing<a class="anchor" aria-label="anchor" href="#arg-processing"></a></dt>
<dd><p>Character string, corresponding to <code>"sequential"</code> (<strong>default</strong> traditional
computing method), or <code>"parallel"</code> processing/evaluation of EPR spectrum fit (optimization of parameters).
The latter dramatically speeds up the execution time for all points (see the <code>N.points.space</code>
argument) of the initial parameter-hyperspace, by dividing all the loops/iterations/evaluations
into smaller sub-tasks, which are processed simultaneously. When selecting
<a href="https://grantmcdermott.com/ds4e/parallel.html" class="external-link">parallel processing</a>,
the function/script automatically detects the number of CPU cores of your machine and selects half of them
(e.g. for 4 cores in total, 2 cores are selected) for the computation. Otherwise, if the hardware resources
are limited (2 cores in total), the <code>processing = "parallel"</code> automatically switches
to <code>"sequential"</code> mode.</p></dd>


<dt id="arg-animation">animation<a class="anchor" aria-label="anchor" href="#arg-animation"></a></dt>
<dd><p>Character string, pointing to name of the animated <code>.gif</code> file, returned
after processing and stored in the working directory (see the <code>Value</code>). If the animation
is not desirable, put <code>animation = NULL</code>. Otherwise, an arbitrary file name can be chosen.
<strong>Default</strong>: <code>animation = "Fitting_of_sim_EPR"</code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>additional arguments specified, see also the <code><a href="eval_sim_EPR_isoFit.html">eval_sim_EPR_isoFit</a></code>,
like <code>tol.step</code>, <code>pswarm</code> arguments (if <code>optim.method = "pswarm"</code>), <code>Blim</code>,
<code>Intensity.expr</code> or <code>Intensity.sim</code> and <code>optim.params.fix.id</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>If the <code>animation</code> argument is different from <code>NULL</code>, the function will return a <code>.gif</code>
  animation of the fitting procedure progress, showing the EPR spectra at each evaluation,
  based on the <code>check.fit.plot</code> argument. The <code>animation</code> file will be stored in the working directory
  of your project. Additionally, a message, appeared in the R console, informs that the animation file was created.
  Regardless of the <code>.gif</code> animation a list with the following elements is provided:</p><dl><dt>df.init.space</dt>
<dd><p>A data frame object representing hyperspace of the initial EPR simulation fitting parameters
  corresponding to <code>optim.params.init</code> and <code>optim.params.init.dvary</code>. Each variable/column corresponds
  to EPR simulation parameter to be optimized and each observation/row is related to one <code>N.points.space</code>,
  dividing the range for each parameter defined by the <code>optim.params.init.dvary</code>. The fitting/optimization
  is performed for each row of the <code>init.space.df</code>.</p></dd>

  <dt>df.optim.space</dt>
<dd><p>Data frame object similar to <code>init.space.df</code>, however with optimized EPR simulation
  parameters (after the fitting procedure). In addition, the <code>optim.space.df</code> contains the following metrics
  of the optimization/fitting as variables/columns: sum of the residual squares <code>RSS</code>,
  standard deviation of residuals <code>residualSD</code>, Akaike information criterion <code>AIC</code> and Bayesian information
  criterion <code>BIC</code>. These four parameters are actually related to optimization/fitting path
  (see the <code>plot.optim.space</code> below).</p></dd>

  <dt>plot.init.space</dt>
<dd><p>A <code>ggplot2</code> object, corresponding to graphical representation of the <code>init.space.df</code>
  created by the <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></code>.</p></dd>

  <dt>plot.optim.space</dt>
<dd><p>A <code>ggplot2</code> object, corresponding to graphical representation of the <code>optim.space.df</code>
  created by the <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></code>. One can also easily recognize the best fit/optimized parameter set,
  because the <code>Evaluation</code> with those parameters is highlighted by the green line. Additionally, each optimized parameter
  <em>vs</em> evaluation relation is fitted by the <code><a href="https://rdrr.io/r/stats/loess.html" class="external-link">loess</a></code> function implemented
  in the <code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></code> in order to show the trend and the \(95\,\%\) confidence interval
  of the parameter optimization. This is especially important for the <code>RSS</code>, <code>residualSD</code>, <code>AIC</code> and <code>BIC</code>,
  as they represent "hills" and "valleys" of the optimization/fitting path to identify the minima.</p></dd>

  <dt>best.fit.params</dt>
<dd><p>Vector of the best final fitting (optimized) parameters (in the <code>plot.optim.space</code> distinguished
  by the green line) and related to the <code>optim.params.init</code> argument.</p></dd>

  <dt>best.lineG.content</dt>
<dd><p>Numeric value of the Gaussian line content of the simulated EPR spectrum.
  If <code>lineG.content.dvary = NULL</code>  it corresponds to the original/initial value (<code>lineG.content</code>).
  Otherwise, a value from the corresponding vector, defined by the <code>lineG.content</code> + <code>lineG.content.dvary</code>
  + <code>N.points.space</code>, and related to the <code>RSS</code> minimum is returned.</p></dd>

  <dt>plots.fit.EPRspec</dt>
<dd><p>List of individual EPR spectra, depending on the <code>check.fit.plot</code> argument and corresponding to
  each <code>Evaluation</code> (refer also to the <code>plot.optim.space</code>). These are the actual spectra by which the animation
  was created.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>In order to monitor and compare load of the hardware resources when running <code>processing = "parallel"</code>
  and <code>"sequential"</code>, one might use the following applications depending on the OS.
  For <em>Windows</em>: <code>task manager</code> GUI (graphical user interface), for <em>Linux</em>:
  terminal applications like <code>top</code>/<code>htop</code> or <code>system monitor</code> GUI and for <code>MacOS</code>
  terminal applications like <code>top</code>/<code>htop</code> or <code>activity monitor</code> GUI.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other Simulations and Optimization:
<code><a href="eval_ABIC_forFit.html">eval_ABIC_forFit()</a></code>,
<code><a href="eval_sim_EPR_iso.html">eval_sim_EPR_iso()</a></code>,
<code><a href="eval_sim_EPR_isoFit.html">eval_sim_EPR_isoFit()</a></code>,
<code><a href="eval_sim_EPR_iso_combo.html">eval_sim_EPR_iso_combo()</a></code>,
<code><a href="optim_for_EPR_fitness.html">optim_for_EPR_fitness()</a></code>,
<code><a href="plot_eval_EPRtheo_mltiplet.html">plot_eval_EPRtheo_mltiplet()</a></code>,
<code><a href="plot_eval_RA_forFit.html">plot_eval_RA_forFit()</a></code>,
<code><a href="quantify_EPR_Sim_series.html">quantify_EPR_Sim_series()</a></code>,
<code><a href="smooth_EPR_Spec_by_npreg.html">smooth_EPR_Spec_by_npreg()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span> <span class="co">## run parallel processing to fit the EPR spectrum</span></span></span>
<span class="r-in"><span> <span class="co">## of the TMPD radical cation (+ zoom the spectrum</span></span></span>
<span class="r-in"><span> <span class="co">## output by `Blim`), animation</span></span></span>
<span class="r-in"><span> <span class="co">## "Fitting_of_sim_EPR.gif" stored in the working dir.</span></span></span>
<span class="r-in"><span> <span class="va">listfit01</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>   <span class="fu">eval_sim_EPR_isoFit_space</span><span class="op">(</span></span></span>
<span class="r-in"><span>     data.spectr.expr <span class="op">=</span> <span class="va">data.tmpd.spec</span>,</span></span>
<span class="r-in"><span>     nu.GHz <span class="op">=</span> <span class="va">data.tmpd.params.values</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>     nuclear.system.noA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>       <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"14N"</span>, <span class="fl">2</span><span class="op">)</span>, <span class="co"># 2 x 14N</span></span></span>
<span class="r-in"><span>       <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"1H"</span>, <span class="fl">4</span><span class="op">)</span>, <span class="co"># 4 x 1H</span></span></span>
<span class="r-in"><span>       <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"1H"</span>, <span class="fl">12</span><span class="op">)</span> <span class="co"># 12 x 1H</span></span></span>
<span class="r-in"><span>     <span class="op">)</span>,</span></span>
<span class="r-in"><span>     optim.params.init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>       <span class="fl">2.0030</span>, <span class="fl">0.4</span>, <span class="fl">0.4</span>, <span class="fl">0</span>,</span></span>
<span class="r-in"><span>       <span class="fl">2.5e5</span>, <span class="fl">20.0</span>, <span class="fl">5.5</span>, <span class="fl">19</span></span></span>
<span class="r-in"><span>     <span class="op">)</span>,</span></span>
<span class="r-in"><span>     optim.params.init.dvary <span class="op">=</span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0002</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0</span>,</span></span>
<span class="r-in"><span>       <span class="fl">2e4</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, <span class="co">## or NULL</span></span></span>
<span class="r-in"><span>     <span class="co"># Nmax.evals = 256,</span></span></span>
<span class="r-in"><span>     <span class="co"># N.points.space = 16, # total number of iters. 4096</span></span></span>
<span class="r-in"><span>     lineG.content <span class="op">=</span> <span class="fl">0.3</span>,</span></span>
<span class="r-in"><span>     lineG.content.dvary <span class="op">=</span> <span class="fl">0.15</span>, <span class="co">## or NULL</span></span></span>
<span class="r-in"><span>     <span class="co"># optim.method = "neldermead",</span></span></span>
<span class="r-in"><span>     processing <span class="op">=</span> <span class="st">"parallel"</span> , <span class="co">## or "sequential"</span></span></span>
<span class="r-in"><span>     Blim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3455</span>,<span class="fl">3545</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="op">)</span></span></span>
<span class="r-in"><span> <span class="co">#</span></span></span>
<span class="r-in"><span> <span class="co">## optimization/fitting progress</span></span></span>
<span class="r-in"><span> <span class="co">## (main graphical output)</span></span></span>
<span class="r-in"><span> <span class="va">listfit01</span><span class="op">$</span><span class="va">plot.optim.space</span></span></span>
<span class="r-in"><span> <span class="co">#</span></span></span>
<span class="r-in"><span> <span class="co">## run the similar processing and evaluation</span></span></span>
<span class="r-in"><span> <span class="co">## like before, but now with the fixed g-value</span></span></span>
<span class="r-in"><span> <span class="co">## (won't be optimized) and with 24 `N.points.space`</span></span></span>
<span class="r-in"><span> <span class="va">listFit02</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>    <span class="fu">eval_sim_EPR_isoFit_space</span><span class="op">(</span></span></span>
<span class="r-in"><span>      data.spectr.expr <span class="op">=</span> <span class="va">data.tmpd.spec</span>,</span></span>
<span class="r-in"><span>      nu.GHz <span class="op">=</span> <span class="va">data.tmpd.params.values</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>      nuclear.system.noA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"14N"</span>, <span class="fl">2</span><span class="op">)</span>, <span class="co"># 2 x 14N</span></span></span>
<span class="r-in"><span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"1H"</span>, <span class="fl">4</span><span class="op">)</span>, <span class="co"># 4 x 1H</span></span></span>
<span class="r-in"><span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"1H"</span>, <span class="fl">12</span><span class="op">)</span> <span class="co"># 12 x 1H</span></span></span>
<span class="r-in"><span>      <span class="op">)</span>,</span></span>
<span class="r-in"><span>      optim.params.init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        <span class="fl">2.00305</span>, <span class="fl">0.4</span>, <span class="fl">0.4</span>, <span class="fl">0</span>,</span></span>
<span class="r-in"><span>        <span class="fl">1.25e4</span>, <span class="fl">20.0</span>, <span class="fl">5.5</span>, <span class="fl">19</span></span></span>
<span class="r-in"><span>      <span class="op">)</span>,</span></span>
<span class="r-in"><span>      optim.params.init.dvary <span class="op">=</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0</span>, <span class="co"># `.dvary` for g-value = 0</span></span></span>
<span class="r-in"><span>        <span class="fl">2e3</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>      <span class="co"># Nmax.evals = 256,</span></span></span>
<span class="r-in"><span>      N.points.space <span class="op">=</span> <span class="fl">24</span>, <span class="co"># total number of iters. 6144</span></span></span>
<span class="r-in"><span>      lineG.content <span class="op">=</span> <span class="fl">0.3</span>,</span></span>
<span class="r-in"><span>      lineG.content.dvary <span class="op">=</span> <span class="fl">0.15</span>,</span></span>
<span class="r-in"><span>      processing <span class="op">=</span> <span class="st">"parallel"</span> ,</span></span>
<span class="r-in"><span>      optim.params.fix.id <span class="op">=</span> <span class="fl">1</span>, <span class="co"># fix g-value</span></span></span>
<span class="r-in"><span>      Blim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3455</span>,<span class="fl">3545</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co">#</span></span></span>
<span class="r-in"><span>  <span class="co">## space (plot) for initial parameters:</span></span></span>
<span class="r-in"><span>  <span class="va">listFit02</span><span class="op">$</span><span class="va">plot.init.space</span></span></span>
<span class="r-in"><span>  <span class="co">#</span></span></span>
<span class="r-in"><span>  <span class="co">## space (plot) for optimized parameters</span></span></span>
<span class="r-in"><span>  <span class="va">listFit02</span><span class="op">$</span><span class="va">plot.optim.space</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ján Tarábek.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

