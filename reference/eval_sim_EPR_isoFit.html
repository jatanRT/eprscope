<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content='As already described in the eval_sim_EPR_iso, analysis of the hyperfine structure (HFS) of EPR spectra
  requires an iterative process with modelling
  the electron-nuclear system followed by a numerical simulations of the spectra to match the experimental ones.
  Fitting, of the simulated spectrum onto the experimental one, therefore represent an important step in such analysis.
  Parameters of the EPR simulated spectrum like \(g_{\text{iso}}\); coupling constants (in MHz)
  \(A_{\text{iso}}\) for each group of equivalent nuclei; linewidth (either \(\Delta B_{\text{pp}}\)
  or \(FWHM\) depending on lineSpecs.form); spectral baseline (see the baseline.correct) and finally
  the intensity (multiplication coefficient) are optimized by those methods listed in optim_for_EPR_fitness
  in order to match the experimental EPR spectrum. The lineG.content corresponding parameter, is the only one,
  which needs to be varied "manually". In order to interactively control the optimization/fitting process,
  similarly to that of in EasySpin,
  a Shiny app is planned to develop, in the future.'><title>Least-Squares Fitting of Isotropic EPR spectra by Simulations — eval_sim_EPR_isoFit • eprscope</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><script src="../extra.js"></script><meta property="og:title" content="Least-Squares Fitting of Isotropic EPR spectra by Simulations — eval_sim_EPR_isoFit"><meta property="og:description" content='As already described in the eval_sim_EPR_iso, analysis of the hyperfine structure (HFS) of EPR spectra
  requires an iterative process with modelling
  the electron-nuclear system followed by a numerical simulations of the spectra to match the experimental ones.
  Fitting, of the simulated spectrum onto the experimental one, therefore represent an important step in such analysis.
  Parameters of the EPR simulated spectrum like \(g_{\text{iso}}\); coupling constants (in MHz)
  \(A_{\text{iso}}\) for each group of equivalent nuclei; linewidth (either \(\Delta B_{\text{pp}}\)
  or \(FWHM\) depending on lineSpecs.form); spectral baseline (see the baseline.correct) and finally
  the intensity (multiplication coefficient) are optimized by those methods listed in optim_for_EPR_fitness
  in order to match the experimental EPR spectrum. The lineG.content corresponding parameter, is the only one,
  which needs to be varied "manually". In order to interactively control the optimization/fitting process,
  similarly to that of in EasySpin,
  a Shiny app is planned to develop, in the future.'><!-- mathjax --><script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js">
</script><!--
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
--><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">eprscope</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.11</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/datasets.html">Package Datasets</a></li>
    <li><a class="dropdown-item" href="../articles/functionality.html">Basic Functionality</a></li>
    <li><a class="dropdown-item" href="../articles/introduction.html">Introduction</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jatanrt/eprscope/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Least-Squares Fitting of Isotropic EPR spectra by Simulations</h1>
      <small class="dont-index">Source: <a href="https://github.com/jatanrt/eprscope/blob/master/R/eval_sim_EPR_isoFit.R" class="external-link"><code>R/eval_sim_EPR_isoFit.R</code></a></small>
      <div class="d-none name"><code>eval_sim_EPR_isoFit.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>As already described in the <code><a href="eval_sim_EPR_iso.html">eval_sim_EPR_iso</a></code>, analysis of the hyperfine structure (HFS) of EPR spectra
  requires an iterative process with modelling
  the <strong>electron-nuclear system</strong> followed by a numerical simulations of the spectra to match the experimental ones.
  Fitting, of the simulated spectrum onto the experimental one, therefore represent an important step in such analysis.
  Parameters of the EPR simulated spectrum like \(g_{\text{iso}}\); coupling constants (in <code>MHz</code>)
  \(A_{\text{iso}}\) for each group of equivalent nuclei; linewidth (either \(\Delta B_{\text{pp}}\)
  or \(FWHM\) depending on <code>lineSpecs.form</code>); spectral baseline (see the <code>baseline.correct</code>) and finally
  the intensity (multiplication coefficient) are optimized by those methods listed in <code><a href="optim_for_EPR_fitness.html">optim_for_EPR_fitness</a></code>
  in order to match the experimental EPR spectrum. The <code>lineG.content</code> corresponding parameter, is the only one,
  which needs to be varied "manually". In order to interactively control the optimization/fitting process,
  similarly to that of in <a href="https://easyspin.org/easyspin/documentation/userguide_fitting.html" class="external-link">EasySpin</a>,
  a <a href="https://www.rstudio.com/products/shiny/" class="external-link">Shiny app</a> is planned to develop, in the future.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">eval_sim_EPR_isoFit</span><span class="op">(</span></span>
<span>  <span class="va">data.spectr.expr</span>,</span>
<span>  Intensity.expr <span class="op">=</span> <span class="st">"dIepr_over_dB"</span>,</span>
<span>  Intensity.sim <span class="op">=</span> <span class="st">"dIeprSim_over_dB"</span>,</span>
<span>  <span class="va">nu.GHz</span>,</span>
<span>  B.unit <span class="op">=</span> <span class="st">"G"</span>,</span>
<span>  <span class="va">nuclear.system.noA</span>,</span>
<span>  baseline.correct <span class="op">=</span> <span class="st">"constant"</span>,</span>
<span>  lineG.content <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  lineSpecs.form <span class="op">=</span> <span class="st">"derivative"</span>,</span>
<span>  optim.method <span class="op">=</span> <span class="st">"neldermead"</span>,</span>
<span>  <span class="va">optim.params.init</span>,</span>
<span>  optim.params.lower <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  optim.params.upper <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  Nmax.evals <span class="op">=</span> <span class="fl">1024</span>,</span>
<span>  tol.step <span class="op">=</span> <span class="fl">5e-07</span>,</span>
<span>  pswarm.size <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pswarm.diameter <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sim.check <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data-spectr-expr">data.spectr.expr<a class="anchor" aria-label="anchor" href="#arg-data-spectr-expr"></a></dt>
<dd><p>Data frame object/table containing the experimental spectral data the with magnetic flux density
(<code>"B_mT"</code> or <code>"B_G"</code>) and the intensity (see the <code>Intensity.expr</code> argument) columns.</p></dd>


<dt id="arg-intensity-expr">Intensity.expr<a class="anchor" aria-label="anchor" href="#arg-intensity-expr"></a></dt>
<dd><p>Character string pointing to column name of the experimental EPR intensity within
the original <code>data.spectr.expr</code>. <strong>Default</strong>: <code>dIepr_over_dB</code>.</p></dd>


<dt id="arg-intensity-sim">Intensity.sim<a class="anchor" aria-label="anchor" href="#arg-intensity-sim"></a></dt>
<dd><p>Character string pointing to column name of the simulated EPR intensity within the related output
data frame. <strong>Default</strong>: <code>Intensity.sim = "dIeprSim_over_dB"</code>.</p></dd>


<dt id="arg-nu-ghz">nu.GHz<a class="anchor" aria-label="anchor" href="#arg-nu-ghz"></a></dt>
<dd><p>Numeric value, microwave frequency in <code>GHz</code>.</p></dd>


<dt id="arg-b-unit">B.unit<a class="anchor" aria-label="anchor" href="#arg-b-unit"></a></dt>
<dd><p>Character string denoting the magnetic flux density unit e.g. <code>B.unit = "G"</code>
(gauss, <strong>default</strong>) or <code>B.unit = "mT"</code> (millitesla). These are the usual units used
for EPR spectra. Additionally, <code>B.unit = "T"</code> (tesla) can be set as well.</p></dd>


<dt id="arg-nuclear-system-noa">nuclear.system.noA<a class="anchor" aria-label="anchor" href="#arg-nuclear-system-noa"></a></dt>
<dd><p>List or nested list <strong>without estimated hyperfine coupling constant values</strong>,
such as <code>list("14N",1)</code> or <code>list(list("14N", 2),list("1H", 4),list("1H", 12))</code>. The \(A\)-values
are already defined as elements of the <code>optim.params.init</code> argument/vector.</p></dd>


<dt id="arg-baseline-correct">baseline.correct<a class="anchor" aria-label="anchor" href="#arg-baseline-correct"></a></dt>
<dd><p>Character string, referring to baseline correction of the simulated/fitted spectrum.
Corrections like <code>"constant"</code> (<strong>default</strong>), <code>"linear"</code> or <code>"quadratic"</code> can be applied.</p></dd>


<dt id="arg-lineg-content">lineG.content<a class="anchor" aria-label="anchor" href="#arg-lineg-content"></a></dt>
<dd><p>Numeric value between <code>0</code> and <code>1</code> referring to content of <em>Gaussian</em> line form.
If <code>lineG.content = 1</code> (<strong>default</strong>) it corresponds to "pure" <em>Gaussian</em> line form
and if <code>lineG.content = 0</code> it corresponds to <em>Lorentzian</em> one. The value from (0,1)
(e.g. <code>lineG.content = 0.5</code>) represents the linear combination (for the example above
with the coefficients 0.5 and 0.5) of both line forms =&gt; so called <em>pseudo-Voight</em>.</p></dd>


<dt id="arg-linespecs-form">lineSpecs.form<a class="anchor" aria-label="anchor" href="#arg-linespecs-form"></a></dt>
<dd><p>Character string describing either <code>"derivative"</code> (<strong>default</strong>)
or <code>"integrated"</code> (i.e. <code>"absorption"</code> which can be used as well) line form
of the analyzed EPR spectrum/data.</p></dd>


<dt id="arg-optim-method">optim.method<a class="anchor" aria-label="anchor" href="#arg-optim-method"></a></dt>
<dd><p>Character string (vector), setting the optimization method(s) gathered within
the <code><a href="optim_for_EPR_fitness.html">optim_for_EPR_fitness</a></code>. <strong>Default</strong>: <code>optim.method = "neldermead"</code>. Additionally,
several consecutive methods can be defined like <code>optim.method = c("levenmarq","neldermead")</code>, where
the best fit parameters from the previous method are used as input for the next one. In such case the output
is <code>list</code> with the elements/vectors from each method in order to see the progress of the optimization.</p></dd>


<dt id="arg-optim-params-init">optim.params.init<a class="anchor" aria-label="anchor" href="#arg-optim-params-init"></a></dt>
<dd><p>Numeric vector with the initial parameter guess (elements) where the <strong>first five
  elements are immutable</strong></p><ol><li><p>g-value (g-factor)</p></li>
<li><p><strong>G</strong>aussian linewidth</p></li>
<li><p><strong>L</strong>orentzian linewidth</p></li>
<li><p>baseline constant (intercept)</p></li>
<li><p>intensity multiplication constant</p></li>
<li><p>baseline slope (only if <code>baseline.correct = "linear"</code> or <code>baseline.correct = "quadratic"</code>),
  if <code>baseline.correct = "constant"</code> it corresponds to the <strong>first HFCC</strong> (\(A_1\))</p></li>
<li><p>baseline quadratic coefficient (only if <code>baseline.correct = "quadratic"</code>),
  if <code>baseline.correct = "constant"</code> it corresponds to the <strong>second HFCC</strong> (\(A_2\)),
  if <code>baseline.correct = "linear"</code> it corresponds to the <strong>first HFCC</strong> (\(A_1\))</p></li>
<li><p>additional HFCC (\(A_3\)) if <code>baseline.correct = "constant"</code> or if
  <code>baseline.correct = "linear"</code> (\(A_2\)), if <code>baseline.correct = "quadratic"</code> it corresponds
  to the <strong>first HFCC</strong> (\(A_1\))</p></li>
<li><p>...additional HFCCs (\(A_k...\), each vector element is reserved only for one \(A\))</p></li>
</ol><p>DO NOT PUT ANY OF THESE PARAMETERS to <code>NULL</code>. If the lineshape is expected to be pure
  <strong>L</strong>orentzian or pure <strong>G</strong>aussian then put the corresponding vector element to <code>0</code>.</p></dd>


<dt id="arg-optim-params-lower">optim.params.lower<a class="anchor" aria-label="anchor" href="#arg-optim-params-lower"></a></dt>
<dd><p>Numeric vector (with the same element order like <code>optim.params.init</code>)
with the lower bound constraints. <strong>Default</strong>: <code>optim.params.lower = NULL</code> which actually
equals to \(g_{\text{init}} - 0.001\), \(0.8\,\Delta B_{\text{G,init}}\),
\(0.8\,\Delta B_{\text{L,init}}\), baseline intercept initial constant \(- 0.001\),
intensity multiplication initial constant \(= 0.8\,\text{init}\), baseline initial slope \(- 5\) (in case
the <code>baseline.correct</code> is set either to <code>"linear"</code> or <code>"quadratic"</code>) and finally,
the baseline initial quadratic coefficient \(- 5\) (in case the <code>baseline.correct</code> is set to
<code>"quadratic"</code>). Lower limits of all hyperfine coupling constant (HFCCs) are set to \(0.9\,A_{\text{init}}\).</p></dd>


<dt id="arg-optim-params-upper">optim.params.upper<a class="anchor" aria-label="anchor" href="#arg-optim-params-upper"></a></dt>
<dd><p>Numeric vector (with the same element order like <code>optim.params.init</code>)
with the upper bound constraints. <strong>Default</strong>: <code>optim.params.upper = NULL</code> which actually
equals to \(g_{\text{init}} + 0.001\), \(1.2\,\Delta B_{\text{G,init}}\),
\(1.2\,\Delta B_{\text{L,init}}\), baseline intercept initial constant \(+ 0.001\),
intensity multiplication initial constant \(= 1.2\,\text{init}\), baseline initial slope \(+ 5\) (in case
the <code>baseline.correct</code> is set either to <code>"linear"</code> or <code>"quadratic"</code>) and finally,
the baseline initial quadratic coefficient \(+ 5\) (in case the <code>baseline.correct</code> is set to
<code>"quadratic"</code>). Upper limits of all HFCCs are set to \(1.1\,A_{\text{init}}\).</p></dd>


<dt id="arg-nmax-evals">Nmax.evals<a class="anchor" aria-label="anchor" href="#arg-nmax-evals"></a></dt>
<dd><p>Numeric value, pointing to maximum number of iterations/evaluations. <strong>Default</strong>:
<code>Nmax.evals = 1024</code> (for <code>optim.method = "levenmarq"</code> this is the maximal value).</p></dd>


<dt id="arg-tol-step">tol.step<a class="anchor" aria-label="anchor" href="#arg-tol-step"></a></dt>
<dd><p>Numeric value describing the smallest optimization step (tolerance) to stop the optimization.
<strong>Default</strong>: <code>tol.step = 5e-7</code>.</p></dd>


<dt id="arg-pswarm-size">pswarm.size<a class="anchor" aria-label="anchor" href="#arg-pswarm-size"></a></dt>
<dd><p>Numeric value equal to particle swarm size (i. e. number of particles), only
if <code>optim.method = "pswarm"</code>. Otherwise, <code>pswarm.size = NULL</code> (<strong>default</strong>).</p></dd>


<dt id="arg-pswarm-diameter">pswarm.diameter<a class="anchor" aria-label="anchor" href="#arg-pswarm-diameter"></a></dt>
<dd><p>Numeric value corresponding to diameter of the particle swarm search space
(in case <code>optim.method = "pswarm"</code>). The <strong>default</strong> value (<code>pswarm.diameter = NULL</code>)
refers to the Euclidian distance, defined as:
$$\sqrt{\sum_k\,(\text{optim.params.upper}[k] - \text{optim.params.lower}[k])^2}$$</p></dd>


<dt id="arg-sim-check">sim.check<a class="anchor" aria-label="anchor" href="#arg-sim-check"></a></dt>
<dd><p>Logical, whether to return simple <code>list</code> with the overlay (simulated + experimental
spectrum) as well as residual plot and the best fitting parameters in a vector
(<code>sim.check = TRUE</code>, <strong>default</strong>). If <code>sim.check = FALSE</code> the list contains
EPR spectra, data frame, best fitting parameters as well as additional statistical measures
of the optimization/fitting procedure (see <code>Value</code>).</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>additional arguments specified (see also <code><a href="optim_for_EPR_fitness.html">optim_for_EPR_fitness</a></code>).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>List with following components depending on <code>sim.check</code>:</p><ol><li><p>if <code>sim.check = TRUE</code> it returns list with two components:</p><dl><dt>plot</dt>
<dd><p>Visualization of the experimental as well as the best fitted EPR simulated spectrum
  in "overlay" mode. Additional graph, below to the latter, showing the residuals (difference between
  the experimental and the fitted simulated EPR spectrum) after the optimization / fitting procedure
  in order to quickly evaluate the quality of the fit.</p></dd>

  <dt>best.fit.params</dt>
<dd><p>Vector of the best (final) fitting parameters to simulate the EPR spectrum,
  see also description of the <code>optim.params.init</code>.</p></dd>


</dl></li>
<li><p>if <code>sim.check = FALSE</code> it returns list with the following components:</p><dl><dt>plot</dt>
<dd><p>Visualization of three spectra which are offset for clarity. The first
  (the upper one) is the original experimental spectrum. The second one (in the middle)
  is the best fitted spectrum together with its baseline counterpart. Finally, the 3rd one
  corresponds to the best fitted spectrum where the baseline counter part was subtracted.</p></dd>

  <dt>best.fit.params</dt>
<dd><p>Vector of the best (final) fitting parameters to simulate the EPR spectrum,
  see also description of the <code>optim.params.init</code>.</p></dd>

  <dt>df</dt>
<dd><p>Data frame (table) with the following variables / columns: magnetic flux density,
  intensity of the experimental spectrum, intensity of the simulated spectrum (including
  the baseline fit), residual intensity of the fit and finally, simulated spectrum intensity
  without the baseline fit.</p></dd>

  <dt>sum.LSQ.min</dt>
<dd><p>The minimal sum of the residual square vector after the least-square
  procedure.</p></dd>

  <dt>N.evals</dt>
<dd><p>Number of iterations/function evaluations completed before termination.
  If the <code>pswarm</code> optimization algorithm is included in <code>optim.method</code>, the <code>N.evals</code>
  equals to vector with the following elements: number of function evaluations, number of iterations
  and the number of restarts.</p></dd>

  <dt>N.converg</dt>
<dd><p>Vector or simple integer code indicating the successful completion
  of the optimization/fit. In the case of <code>"levenmarq"</code> method, the vector elements equals
  to sum of squares at each iteration.</p></dd>


</dl></li>
</ol></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other Simulations and Optimization:
<code><a href="eval_sim_EPR_iso.html">eval_sim_EPR_iso</a>()</code>,
<code><a href="eval_sim_EPR_iso_combo.html">eval_sim_EPR_iso_combo</a>()</code>,
<code><a href="optim_for_EPR_fitness.html">optim_for_EPR_fitness</a>()</code>,
<code><a href="quantify_EPR_Sim_series.html">quantify_EPR_Sim_series</a>()</code>,
<code><a href="smooth_EPR_Spec_by_npreg.html">smooth_EPR_Spec_by_npreg</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## loading built-in example dataset which is simple</span></span></span>
<span class="r-in"><span><span class="co">## EPR spectrum of the aminoxyl radical:</span></span></span>
<span class="r-in"><span><span class="va">aminoxyl.data.path</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="load_data_example.html">load_data_example</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"Aminoxyl_radical_a.txt"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">aminoxyl.data</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="readEPR_Exp_Specs.html">readEPR_Exp_Specs</a></span><span class="op">(</span><span class="va">aminoxyl.data.path</span>,</span></span>
<span class="r-in"><span>                    qValue <span class="op">=</span> <span class="fl">2100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## EPR spectrum simulation fit with "Nelder-Mead"</span></span></span>
<span class="r-in"><span><span class="co">## optimization method with `sim.check = FALSE`:</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.a</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu">eval_sim_EPR_isoFit</span><span class="op">(</span>data.spectr.expr <span class="op">=</span> <span class="va">aminoxyl.data</span>,</span></span>
<span class="r-in"><span>    nu.GHz <span class="op">=</span> <span class="fl">9.806769</span>,</span></span>
<span class="r-in"><span>    lineG.content <span class="op">=</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>    optim.method <span class="op">=</span> <span class="st">"neldermead"</span>,</span></span>
<span class="r-in"><span>    nuclear.system.noA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"14N"</span>,<span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    baseline.correct <span class="op">=</span> <span class="st">"linear"</span>,</span></span>
<span class="r-in"><span>    optim.params.init <span class="op">=</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.006</span>, <span class="co"># g-value</span></span></span>
<span class="r-in"><span>        <span class="fl">4.8</span>, <span class="co"># G Delta Bpp</span></span></span>
<span class="r-in"><span>        <span class="fl">4.8</span>, <span class="co"># L Delta Bpp</span></span></span>
<span class="r-in"><span>        <span class="fl">0</span>, <span class="co"># intercept (constant) lin. baseline</span></span></span>
<span class="r-in"><span>        <span class="fl">0.016</span>, <span class="co"># Sim. intensity multiply</span></span></span>
<span class="r-in"><span>        <span class="fl">1e-6</span>, <span class="co"># slope lin. baseline</span></span></span>
<span class="r-in"><span>        <span class="fl">49</span><span class="op">)</span>, <span class="co"># A in MHz</span></span></span>
<span class="r-in"><span>    sim.check <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## OUTPUTS-RETURN:</span></span></span>
<span class="r-in"><span><span class="co">## best fit parameters:</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.a</span><span class="op">$</span><span class="va">best.fit.params</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  2.005945e+00  5.127888e+00  5.209871e+00 -4.639211e-05  1.585515e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6]  1.334143e-08  5.051325e+01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## spectrum plot with experimental spectrum,</span></span></span>
<span class="r-in"><span><span class="co">## simulated one with the linear baseline fit</span></span></span>
<span class="r-in"><span><span class="co">## and simulated one with the linear baseline</span></span></span>
<span class="r-in"><span><span class="co">## fit subtracted:</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.a</span><span class="op">$</span><span class="va">plot</span></span></span>
<span class="r-plt img"><img src="eval_sim_EPR_isoFit-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## minimal sum of squared residuals:</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.a</span><span class="op">$</span><span class="va">sum.LSQ.min</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 3.744428e-07</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## number of evaluations / iterations:</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.a</span><span class="op">$</span><span class="va">N.evals</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1024</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## convergence, in this case it is represented</span></span></span>
<span class="r-in"><span><span class="co">## by the integer code indicating the successful</span></span></span>
<span class="r-in"><span><span class="co">## completion (it must be &gt; 0):</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.a</span><span class="op">$</span><span class="va">N.converg</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## preview of data frame including all spectra:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">tempo.test.sim.fit.a</span><span class="op">$</span><span class="va">df</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         B_G    Experiment    Simulation    Residuals Simulation_NoBasLin</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       &lt;num&gt;         &lt;num&gt;         &lt;num&gt;        &lt;num&gt;               &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1: 3332.700 -1.773856e-06 -1.923358e-06 1.495017e-07        5.777759e-09</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2: 3332.900  1.220946e-07 -1.920667e-06 2.042762e-06        5.800145e-09</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3: 3333.101 -1.840379e-07 -1.917963e-06 1.733925e-06        5.822762e-09</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4: 3333.301 -7.164141e-08 -1.915272e-06 1.843631e-06        5.845383e-09</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5: 3333.502 -1.736144e-06 -1.912568e-06 1.764234e-07        5.868236e-09</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6: 3333.702 -5.153117e-07 -1.909877e-06 1.394565e-06        5.891095e-09</span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## similar EPR spectrum simulation fit with "particle swarm"</span></span></span>
<span class="r-in"><span><span class="co">## optimization algorithm and `sim.check = TRUE` option</span></span></span>
<span class="r-in"><span><span class="co">## as well as user defined bound constraints:</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.b</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu">eval_sim_EPR_isoFit</span><span class="op">(</span>data.spectr.expr <span class="op">=</span> <span class="va">aminoxyl.data</span>,</span></span>
<span class="r-in"><span>    nu.GHz <span class="op">=</span> <span class="fl">9.806769</span>,</span></span>
<span class="r-in"><span>    lineG.content <span class="op">=</span> <span class="fl">0.4</span>,</span></span>
<span class="r-in"><span>    optim.method <span class="op">=</span> <span class="st">"pswarm"</span>,</span></span>
<span class="r-in"><span>    nuclear.system.noA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"14N"</span>,<span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    baseline.correct <span class="op">=</span> <span class="st">"constant"</span>,</span></span>
<span class="r-in"><span>    optim.params.init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.006</span>,<span class="fl">4.8</span>,<span class="fl">4.8</span>,<span class="fl">0</span>,<span class="fl">1.1e-2</span>,<span class="fl">49</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    optim.params.lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.0048</span>,<span class="fl">4.4</span>,<span class="fl">4.4</span>,<span class="op">-</span><span class="fl">1e-4</span>,<span class="fl">9e-3</span>,<span class="fl">45</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    optim.params.upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.0072</span>,<span class="fl">5.2</span>,<span class="fl">5.2</span>,<span class="fl">1e-4</span>,<span class="fl">1.5e-2</span>,<span class="fl">53</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    sim.check <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## OUTPUTS-RETURN:</span></span></span>
<span class="r-in"><span><span class="co">## best fit parameters:</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.b</span><span class="op">$</span><span class="va">best.fit.params</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2.005256e+00 4.710182e+00 4.400000e+00 9.523309e-08 1.500000e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6] 5.258035e+01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## quick simulation check by plotting the both</span></span></span>
<span class="r-in"><span><span class="co">## simulated and the experimental EPR spectra</span></span></span>
<span class="r-in"><span><span class="co">## together with the residuals (differences between the</span></span></span>
<span class="r-in"><span><span class="co">## both latter)</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.b</span><span class="op">$</span><span class="va">plot</span></span></span>
<span class="r-plt img"><img src="eval_sim_EPR_isoFit-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## fitting of the aminoxyl EPR spectrum</span></span></span>
<span class="r-in"><span><span class="co">## by the combination of the 1. "Levenberg-Marquardt"</span></span></span>
<span class="r-in"><span><span class="co">## and 2. "Nelder-Mead" algorithms</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.c</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu">eval_sim_EPR_isoFit</span><span class="op">(</span><span class="va">aminoxyl.data</span>,</span></span>
<span class="r-in"><span>                      nu.GHz <span class="op">=</span> <span class="fl">9.86769</span>,</span></span>
<span class="r-in"><span>                      lineG.content <span class="op">=</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>                      optim.method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"levenmarq"</span>,</span></span>
<span class="r-in"><span>                                       <span class="st">"neldermead"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                      nuclear.system.noA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"14N"</span>,<span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                      baseline.correct <span class="op">=</span> <span class="st">"constant"</span>,</span></span>
<span class="r-in"><span>                      optim.params.init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.0060</span>,</span></span>
<span class="r-in"><span>                                            <span class="fl">4.8</span>,</span></span>
<span class="r-in"><span>                                            <span class="fl">4.8</span>,</span></span>
<span class="r-in"><span>                                            <span class="fl">0</span>,</span></span>
<span class="r-in"><span>                                            <span class="fl">7e-3</span>,</span></span>
<span class="r-in"><span>                                            <span class="fl">49</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                      sim.check <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span>                    <span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## OUTPUTS-RETURN:</span></span></span>
<span class="r-in"><span><span class="co">## best fit parameters for both procedures within a list:</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.c</span><span class="op">$</span><span class="va">best.fit.params</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  2.006000e+00  5.760000e+00  5.760000e+00 -9.656459e-10  8.400000e-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6]  4.900000e+01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  2.007000e+00  4.745743e+00  3.840000e+00 -6.036948e-10  8.400000e-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6]  5.348910e+01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## compare the results with the example in the `readMAT_params_file`,</span></span></span>
<span class="r-in"><span><span class="co">## corresponding to the best fit from `Easyspin`</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## `N.converg` also consists of two components</span></span></span>
<span class="r-in"><span><span class="co">## each corresponding to result of the individual</span></span></span>
<span class="r-in"><span><span class="co">## optimization method where the "levenmarq" returns</span></span></span>
<span class="r-in"><span><span class="co">## sum of squares at each iteration, therefore the 1st</span></span></span>
<span class="r-in"><span><span class="co">## component is vector and the 2nd one is integer code</span></span></span>
<span class="r-in"><span><span class="co">## as already stated above:</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.c</span><span class="op">$</span><span class="va">N.converg</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.657319e-06 1.574711e-06 1.567632e-06 1.567632e-06</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ján Tarábek.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

