<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content='Fitting of the simulated spectrum onto the experimental one represents an important step in the analysis
  of EPR spectra. Parameters of the simulated spectrum like \(g_{\text{iso}}\); coupling constants
  (in MHz) \(A_{\text{iso}}\) for each group of equivalent nuclei; linewidth
  (either \(\Delta B_{\text{pp}}\) or \(FWHM\) depending on the lineSpecs.form argument);
  spectral baseline (see the baseline.correct argument) and finally the intensity (multiplication coefficient)
  are optimized by the methods listed in optim_for_EPR_fitness.
  The lineG.content corresponding parameter is the only one,
  which needs to be varied "manually". For an extended version of this function
  (including automatic lineG.content variations), please refer to the eval_sim_EPR_isoFit_space.'><title>Least-Squares Fitting of Isotropic EPR Spectra by Simulations — eval_sim_EPR_isoFit • eprscope</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><script src="../extra.js"></script><meta property="og:title" content="Least-Squares Fitting of Isotropic EPR Spectra by Simulations — eval_sim_EPR_isoFit"><meta property="og:description" content='Fitting of the simulated spectrum onto the experimental one represents an important step in the analysis
  of EPR spectra. Parameters of the simulated spectrum like \(g_{\text{iso}}\); coupling constants
  (in MHz) \(A_{\text{iso}}\) for each group of equivalent nuclei; linewidth
  (either \(\Delta B_{\text{pp}}\) or \(FWHM\) depending on the lineSpecs.form argument);
  spectral baseline (see the baseline.correct argument) and finally the intensity (multiplication coefficient)
  are optimized by the methods listed in optim_for_EPR_fitness.
  The lineG.content corresponding parameter is the only one,
  which needs to be varied "manually". For an extended version of this function
  (including automatic lineG.content variations), please refer to the eval_sim_EPR_isoFit_space.'><!-- mathjax --><script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js">
</script><!--
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
--><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">eprscope</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.15</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/datasets.html">Package Datasets</a></li>
    <li><a class="dropdown-item" href="../articles/firstSteps.html">First Steps with R Language</a></li>
    <li><a class="dropdown-item" href="../articles/functionality.html">Basic Functionality</a></li>
    <li><a class="dropdown-item" href="../articles/introduction.html">Introduction</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jatanrt/eprscope/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Least-Squares Fitting of Isotropic EPR Spectra by Simulations</h1>
      <small class="dont-index">Source: <a href="https://github.com/jatanrt/eprscope/blob/master/R/eval_sim_EPR_isoFit.R" class="external-link"><code>R/eval_sim_EPR_isoFit.R</code></a></small>
      <div class="d-none name"><code>eval_sim_EPR_isoFit.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Fitting of the simulated spectrum onto the experimental one represents an important step in the analysis
  of EPR spectra. Parameters of the simulated spectrum like \(g_{\text{iso}}\); coupling constants
  (in <code>MHz</code>) \(A_{\text{iso}}\) for each group of equivalent nuclei; linewidth
  (either \(\Delta B_{\text{pp}}\) or \(FWHM\) depending on the <code>lineSpecs.form</code> argument);
  spectral baseline (see the <code>baseline.correct</code> argument) and finally the intensity (multiplication coefficient)
  are optimized by the methods listed in <code><a href="optim_for_EPR_fitness.html">optim_for_EPR_fitness</a></code>.
  The <code>lineG.content</code> corresponding parameter is the only one,
  which needs to be varied "manually". For an extended version of this function
  (including automatic <code>lineG.content</code> variations), please refer to the <code><a href="eval_sim_EPR_isoFit_space.html">eval_sim_EPR_isoFit_space</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">eval_sim_EPR_isoFit</span><span class="op">(</span></span>
<span>  <span class="va">data.spectr.expr</span>,</span>
<span>  Intensity.expr <span class="op">=</span> <span class="st">"dIepr_over_dB"</span>,</span>
<span>  Intensity.sim <span class="op">=</span> <span class="st">"dIeprSim_over_dB"</span>,</span>
<span>  <span class="va">nu.GHz</span>,</span>
<span>  B.unit <span class="op">=</span> <span class="st">"G"</span>,</span>
<span>  Blim <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  nuclear.system.noA <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  baseline.correct <span class="op">=</span> <span class="st">"constant"</span>,</span>
<span>  lineG.content <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  lineSpecs.form <span class="op">=</span> <span class="st">"derivative"</span>,</span>
<span>  optim.method <span class="op">=</span> <span class="st">"neldermead"</span>,</span>
<span>  <span class="va">optim.params.init</span>,</span>
<span>  optim.params.fix.id <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  optim.params.lower <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  optim.params.upper <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  Nmax.evals <span class="op">=</span> <span class="fl">512</span>,</span>
<span>  check.fit.plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  msg.optim.progress <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  output.list.forFitSp <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data-spectr-expr">data.spectr.expr<a class="anchor" aria-label="anchor" href="#arg-data-spectr-expr"></a></dt>
<dd><p>Data frame object/table, containing the experimental spectral data with the magnetic flux density
(<code>"B_mT"</code> or <code>"B_G"</code>) and the intensity (see the <code>Intensity.expr</code> argument) columns.</p></dd>


<dt id="arg-intensity-expr">Intensity.expr<a class="anchor" aria-label="anchor" href="#arg-intensity-expr"></a></dt>
<dd><p>Character string, pointing to column name of the experimental EPR intensity within
the original <code>data.spectr.expr</code>. <strong>Default</strong>: <code>dIepr_over_dB</code>.</p></dd>


<dt id="arg-intensity-sim">Intensity.sim<a class="anchor" aria-label="anchor" href="#arg-intensity-sim"></a></dt>
<dd><p>Character string, pointing to column name of the simulated EPR intensity within the related output
data frame. <strong>Default</strong>: <code>Intensity.sim = "dIeprSim_over_dB"</code>.</p></dd>


<dt id="arg-nu-ghz">nu.GHz<a class="anchor" aria-label="anchor" href="#arg-nu-ghz"></a></dt>
<dd><p>Numeric value, microwave frequency in <code>GHz</code>.</p></dd>


<dt id="arg-b-unit">B.unit<a class="anchor" aria-label="anchor" href="#arg-b-unit"></a></dt>
<dd><p>Character string, denoting the magnetic flux density unit e.g. <code>B.unit = "G"</code>
(gauss, <strong>default</strong>) or <code>B.unit = "mT"</code>/<code>"T"</code> (millitesla/tesla).</p></dd>


<dt id="arg-blim">Blim<a class="anchor" aria-label="anchor" href="#arg-blim"></a></dt>
<dd><p>Numeric vector, magnetic flux density in <code>mT</code>/<code>G</code>
corresponding to lower and upper <strong>visual limit</strong> of the selected \(B\)-region,
such as <code>Blim = c(3495.4,3595.4)</code>. <strong>Default</strong>: <code>Blim = NULL</code> (corresponding to the entire
\(B\)-range of EPR spectrum). <strong>This does not correspond to simulation fit data region !</strong>.
If narrower \(B\)-region (in comparison to the original one) is required to fit the EPR spectrum,
the filtering has to be done prior to own fitting procedure. For example, if the original data frame
(<code>df.spectr.orgin</code> within 200 G), of the experimental EPR spectrum, should be fitted within
the region of <code>B = c(3450,3550)</code> (100 G), following operation must be performed:
<code>df.spectr.actuall &lt;- df.spectr.origin |&gt; dplyr::filter(dplyr::between(B_G,3450,3550))</code>,
where the <code>df.spectr.actuall</code> serves as an input (represented by the <code>data.spectr.expr</code>
argument) for the function.</p></dd>


<dt id="arg-nuclear-system-noa">nuclear.system.noA<a class="anchor" aria-label="anchor" href="#arg-nuclear-system-noa"></a></dt>
<dd><p>List or nested list <strong>without estimated hyperfine coupling constant values</strong>,
such as <code>list("14N",1)</code> or <code>list(list("14N", 2),list("1H", 4),list("1H", 12))</code>. The \(A\)-values
are already defined as elements of the <code>optim.params.init</code> argument/vector. If the EPR spectrum
does not display any hyperfine splitting, the argument definition reads <code>nuclear.system.noA = NULL</code> (<strong>default</strong>).</p></dd>


<dt id="arg-baseline-correct">baseline.correct<a class="anchor" aria-label="anchor" href="#arg-baseline-correct"></a></dt>
<dd><p>Character string, referring to baseline correction of the simulated/fitted spectrum.
Corrections like <code>"constant"</code> (<strong>default</strong>), <code>"linear"</code> or <code>"quadratic"</code> can be applied.</p></dd>


<dt id="arg-lineg-content">lineG.content<a class="anchor" aria-label="anchor" href="#arg-lineg-content"></a></dt>
<dd><p>Numeric value between <code>0</code> and <code>1</code>, referring to content of the <em>Gaussian</em> line form.
If <code>lineG.content = 1</code> (<strong>default</strong>) it corresponds to "pure" <em>Gaussian</em> line form
and if <code>lineG.content = 0</code> it corresponds to <em>Lorentzian</em> one. The value from (0,1)
(e.g. <code>lineG.content = 0.5</code>) represents the linear combination (for the example above,
with the coefficients 0.5 and 0.5) of both line forms =&gt; so called <em>pseudo-Voigt</em>.</p></dd>


<dt id="arg-linespecs-form">lineSpecs.form<a class="anchor" aria-label="anchor" href="#arg-linespecs-form"></a></dt>
<dd><p>Character string, describing either <code>"derivative"</code> (<strong>default</strong>)
or <code>"integrated"</code> (i.e. <code>"absorption"</code> which can be used as well) line form
of the analyzed EPR spectrum/data.</p></dd>


<dt id="arg-optim-method">optim.method<a class="anchor" aria-label="anchor" href="#arg-optim-method"></a></dt>
<dd><p>Character string (vector), setting the optimization method(s) gathered within
the <code><a href="optim_for_EPR_fitness.html">optim_for_EPR_fitness</a></code>. <strong>Default</strong>: <code>optim.method = "neldermead"</code>. Additionally,
several consecutive methods can be defined like <code>optim.method = c("levenmarq","neldermead")</code>, where
the best fit parameters from the previous method are used as input for the next one. In such case, the output
is <code>list</code> with the elements/vectors from each method, in order to see the progress of the optimization.</p></dd>


<dt id="arg-optim-params-init">optim.params.init<a class="anchor" aria-label="anchor" href="#arg-optim-params-init"></a></dt>
<dd><p>Numeric vector with the initial parameter guess (elements) where the <strong>first five
  elements are immutable</strong></p><ol><li><p>g-value (g-factor)</p></li>
<li><p><strong>G</strong>aussian linewidth</p></li>
<li><p><strong>L</strong>orentzian linewidth</p></li>
<li><p>baseline constant (intercept or offset)</p></li>
<li><p>intensity multiplication constant</p></li>
<li><p>baseline slope (only if <code>baseline.correct = "linear"</code> or <code>baseline.correct = "quadratic"</code>),
  if <code>baseline.correct = "constant"</code> it corresponds to the <strong>first HFCC</strong> (\(A_1\))</p></li>
<li><p>baseline quadratic coefficient (only if <code>baseline.correct = "quadratic"</code>),
  if <code>baseline.correct = "constant"</code> it corresponds to the <strong>second HFCC</strong> (\(A_2\)),
  if <code>baseline.correct = "linear"</code> it corresponds to the <strong>first HFCC</strong> (\(A_1\))</p></li>
<li><p>additional HFCC (\(A_3\)) if <code>baseline.correct = "constant"</code> or if
  <code>baseline.correct = "linear"</code> (\(A_2\)), if <code>baseline.correct = "quadratic"</code> it corresponds
  to the <strong>first HFCC</strong> (\(A_1\))</p></li>
<li><p>...additional HFCCs (\(A_k...\), each vector element is reserved only for one \(A\))</p></li>
</ol><p>DO NOT PUT ANY OF THESE PARAMETERS to <code>NULL</code>. If the lineshape is expected to be pure
  <strong>L</strong>orentzian or pure <strong>G</strong>aussian then put the corresponding vector element to <code>0</code>.</p></dd>


<dt id="arg-optim-params-fix-id">optim.params.fix.id<a class="anchor" aria-label="anchor" href="#arg-optim-params-fix-id"></a></dt>
<dd><p>Numeric value/vector of index/indices of the <code>optim.params.init</code>, corresponding
to optimization/simulation parameter(s) to be fixed. For example, if the g-Value and the (intensity) multiplication
constant should not be optimized (their values should be fixed during the procedure), the argument must be defined
as follows: <code>optim.params.fix.id = c(1,5)</code> (see also the <code>optim.params.init</code> description
for the simulation/optimized parameters order). <strong>Default</strong>: <code>optim.params.fix.id = NULL</code>, indicating
that none of the <code>optim.params.init</code> is fixed, i.e. all parameters are optimized within their default/defined
boundaries (see the <code>optim.params.lower</code> and the <code>optim.params.upper</code>). Alternatively, the parameter value(s)
can be also fixed by assigning the <code>optim.params.init</code> + <code>optim.params.lower</code> + <code>optim.params.upper</code>
to equal value as demonstrated in the <code>Examples</code>.</p></dd>


<dt id="arg-optim-params-lower">optim.params.lower<a class="anchor" aria-label="anchor" href="#arg-optim-params-lower"></a></dt>
<dd><p>Numeric vector (with the same element order like <code>optim.params.init</code>)
with the lower bound constraints. <strong>Default</strong>: <code>optim.params.lower = NULL</code> which actually
equals to \(g_{\text{init}} - 0.001\), \(0.8\,\Delta B_{\text{G,init}}\),
\(0.8\,\Delta B_{\text{L,init}}\), baseline intercept initial constant \(- 0.001\),
intensity multiplication initial constant \(= 0.75\,\text{init}\), baseline initial slope \(- 5\) (in case
the <code>baseline.correct</code> is set either to <code>"linear"</code> or <code>"quadratic"</code>) and finally,
the baseline initial quadratic coefficient \(- 5\) (in case the <code>baseline.correct</code> is set to
<code>"quadratic"</code>). Default lower limits of all hyperfine coupling constant (HFCCs) are set to \(0.875\,A_{\text{init}}\).</p></dd>


<dt id="arg-optim-params-upper">optim.params.upper<a class="anchor" aria-label="anchor" href="#arg-optim-params-upper"></a></dt>
<dd><p>Numeric vector (with the same element order like <code>optim.params.init</code>)
with the upper bound constraints. <strong>Default</strong>: <code>optim.params.upper = NULL</code> which actually
equals to \(g_{\text{init}} + 0.001\), \(1.2\,\Delta B_{\text{G,init}}\),
\(1.2\,\Delta B_{\text{L,init}}\), baseline intercept initial constant \(+ 0.001\),
intensity multiplication initial constant \(= 1.25\,\text{init}\), baseline initial slope \(+ 5\) (in case
the <code>baseline.correct</code> is set either to <code>"linear"</code> or <code>"quadratic"</code>) and finally,
the baseline initial quadratic coefficient \(+ 5\) (in case the <code>baseline.correct</code> is set to
<code>"quadratic"</code>). Default upper limits of all HFCCs are set to \(1.125\,A_{\text{init}}\).</p></dd>


<dt id="arg-nmax-evals">Nmax.evals<a class="anchor" aria-label="anchor" href="#arg-nmax-evals"></a></dt>
<dd><p>Numeric value, maximum number of function evaluations and/or iterations.
The only one method, limited by this argument, is <code><a href="https://rdrr.io/pkg/minpack.lm/man/nls.lm.html" class="external-link">nls.lm</a></code>, where
<code>Nmax.evals = 1024</code>. Higher <code>Nmax.evals</code> may extremely extend the optimization
time, therefore the <strong>default</strong> value reads <code>Nmax.evals = 512</code>. However, the <code>"pswarm"</code>
method requires at least the default or even higher values.</p></dd>


<dt id="arg-check-fit-plot">check.fit.plot<a class="anchor" aria-label="anchor" href="#arg-check-fit-plot"></a></dt>
<dd><p>Logical, whether to return overlay plot with the initial simulation + the best simulation
fit + experimental spectrum (including residuals in the lower part of the plot,
<code>check.fit.plot = TRUE</code>, <strong>default</strong>) or with the following three spectra
(<code>check.fit.plot = FALSE</code>): 1. experimental, 2. the best simulated one with the baseline fit
and 3. the best simulated spectrum with the baseline fit subtracted. The latter two are offset for clarity,
within the plot.</p></dd>


<dt id="arg-msg-optim-progress">msg.optim.progress<a class="anchor" aria-label="anchor" href="#arg-msg-optim-progress"></a></dt>
<dd><p>Logical, whether to display message (in the R console) about progress of the <code>optim.method</code>
during the optimization/fitting procedure, e.g.
<code>"EPR simulation parameters are currently being optimized by NELDERMEAD, method 1 of 2..."</code> and at the end
it shows the elapsed time. <strong>Default</strong>: <code>msg.optim.progress = TRUE</code>. If <code>FALSE</code>, no message
is displayed. Latter option is especially suitable for the case when <code>output.list.forFitSp = TRUE</code> (see below).
This argument can be combined with the optional <code>eval.optim.progress</code> (see below or described in the
<code><a href="optim_for_EPR_fitness.html">optim_for_EPR_fitness</a></code>).</p></dd>


<dt id="arg-output-list-forfitsp">output.list.forFitSp<a class="anchor" aria-label="anchor" href="#arg-output-list-forfitsp"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, <code>list</code> with the following components will be exclusively returned:
1. optimized parameters from the best fit (together with the minimum sum of residual squares)
and 2. Plot of the experimental as well as simulated EPR spectrum depending on <code>check.fit.plot</code> (see <code>Value</code>).
Such output is applied for the <code><a href="eval_sim_EPR_isoFit_space.html">eval_sim_EPR_isoFit_space</a></code>,
therefore, the <strong>default</strong> value reads <code>output.list.final = FALSE</code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>additional arguments specified, see also <code><a href="optim_for_EPR_fitness.html">optim_for_EPR_fitness</a></code>,
like <code>eval.optim.progress = TRUE</code> (which is <code>FALSE</code> by <strong>default</strong>), <code>pswarm.size</code>,
<code>pswarm.diameter</code>, <code>pswarm.type</code>, <code>tol.step</code> + <code>optim.method</code> depended additional arguments.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Optimization/Fitting procedure results in vector or data frame or list depending on the <code>check.fit.plot</code>
  and <code>output...</code> arguments.</p><ol><li><p>If <code>check.fit.plot = TRUE</code> or <code>check.fit.plot = FALSE</code>, the result corresponds
  to list with the following components:</p><dl><dt>plot</dt>
<dd><p>Visualization of the experimental as well as the best fitted EPR simulated spectra.
  If <code>check.fit.plot = TRUE</code>, the overlay plot consists of the initial simulation + the best simulation
  fit + experimental spectrum, including residuals in the plot lower part. Whereas, if <code>check.fit.plot = FALSE</code>,
  following three spectra are available: 1. experimental, 2. the best simulated one with the baseline fit
  and 3. the best simulated spectrum with the baseline fit subtracted. The latter two are offset for clarity.</p></dd>

  <dt>ra</dt>
<dd><p>Simple residual analysis - a list consisting of 4 elements: diagnostic plots
  <code>plot.rqq()</code> function, <code>plot.histDens</code>; original data frame (<code>df</code>) with residuals and their corresponding
  standard deviation (<code>sd</code>). For details, please refer to the <code><a href="plot_eval_RA_forFit.html">plot_eval_RA_forFit</a></code>.</p></dd>

  <dt>best.fit.params</dt>
<dd><p>Vector of the best (final) fitting (optimized) parameters, for each corresponding
  <code>optim.method</code>, to simulate the experimental EPR spectrum, see also description of the <code>optim.params.init</code>.</p></dd>

  <dt>df</dt>
<dd><p>Tidy data frame (table) with the magnetic flux density and intensities of the experimental,
  the best simulated/fitted, as well as the initially simulated EPR spectrum and residuals
  (if <code>check.fit.plot = TRUE</code>), or wide data frame with the following variables / columns
  (for <code>check.fit.plot = FALSE</code>): magnetic flux density, intensity of the experimental
  spectrum, intensity of the best simulated one (including the baseline fit), residual intensity and finally,
  the best simulated spectrum intensity without the baseline fit.</p></dd>

  <dt>min.rss</dt>
<dd><p>Minimum sum of residual squares (vector) after the least-square procedure.</p></dd>

  <dt>cov.df</dt>
<dd><p>Covariance <code>matrix</code> of a data frame, consisting of EPR experimental, simulated (best fit) and the residual
  intensities as columns/variables. Covariance between the experiment and simulation should be positive and strong
  for a decent fit. Contrary, the <code>cov</code> between the simulation and residuals should be ideally close to <code>0</code>,
  indicating no systematic relationship. However, the covariance is scale-depended and must be "normalized". Therefore,
  for such a purpose, the correlation is defined as shown below.</p></dd>

  <dt>cor.df</dt>
<dd><p>Correlation <code>matrix</code> of a data frame, consisting of EPR experimental,
  simulated (best fit) and residual intensities as columns/variables. Such matrix can be additionally nicely visualized
  by a correlation <code>plot</code> created by the <code><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html" class="external-link">corrplot</a></code> function.
  A higher positive correlation (between the experiment
  and the best fit), with the value close to <code>1</code>, indicates that simulation best fit nicely follows
  the experimental spectrum. Contrary, no clear correlation between the residuals and the experimental/fitted
  EPR intensities must be visible. Therefore, such correlation should be ideally close to <code>0</code>.</p></dd>

  <dt>abic</dt>
<dd><p>A list consisting of Akaike and Bayesian information criteria (AIC &amp; BIC) vector (<code>abic.vec</code>)
  and <code>message</code>, denoting the residuals/errors distribution, applied to evaluate
  those criteria. To be used when comparing different simulation fits. The lower the (negative) values,
  the better the fit. Please, refer to the <code><a href="eval_ABIC_forFit.html">eval_ABIC_forFit</a></code>.</p></dd>

  <dt>N.evals</dt>
<dd><p>Number of iterations/function evaluations completed before termination.
  If the <code>pswarm</code> optimization algorithm is included in <code>optim.method</code>, the <code>N.evals</code>
  equals to vector with the following elements: number of function evaluations, number of iterations (per one particle)
  and the number of restarts.</p></dd>

  <dt>N.converg</dt>
<dd><p>Vector or simple integer code indicating the successful completion
  of the optimization/fit. In the case of <code>"levenmarq"</code> method, the vector elements coincide with
  the sum of residual squares at each iteration. If the <code>optim.method = "pswarm"</code> is applied, one of the following
  codes can be returned: <code>0</code>: algorithm terminated by reaching the absolute tolerance,
  <code>1</code>: maximum number of function evaluations reached, <code>2</code>: maximum number of iterations reached,
  <code>3</code>: maximum number of restarts reached, <code>4</code>: maximum number of iterations without improvement reached.
  For all the other remaining methods (coming from <code>{nloptr}</code> package), the integers have to be positive
  to indicate successful convergence.</p></dd>


</dl></li>
<li><p>If <code>output.list.forFitSp = TRUE</code>, the function exclusively returns list with the two components,
  which is to be applied for the <code><a href="eval_sim_EPR_isoFit_space.html">eval_sim_EPR_isoFit_space</a></code>.</p><dl><dt>params</dt>
<dd><p>A vector, containing the following elements:</p><ol><li><p>The best fitting (optimized) parameters (related to the <code>optim.params.init</code> argument).</p></li>
<li><p>Minimum sum of residual squares (corresponding to previous item).</p></li>
<li><p>Standard deviation of residuals, after the (final) <code>optim.method</code> procedure.</p></li>
<li><p>Akaike Information Criterion/AIC metric (refer to <code><a href="eval_ABIC_forFit.html">eval_ABIC_forFit</a></code>),
  after the (final) <code>optim.method</code>.</p></li>
<li><p>Bayesian Information Criterion/BIC metric (refer to <code><a href="eval_ABIC_forFit.html">eval_ABIC_forFit</a></code>),
  after the (final) <code>optim.method</code>.</p></li>
</ol></dd>

  <dt>plot</dt>
<dd><p>Visualization of the experimental as well as the best fitted EPR simulated spectra depending
  on the <code>check.fit.plot</code>. It corresponds either to EPR spectra with residuals or to those with baseline correction,
  (please, refer to the <code>check.fit.plot</code> argument description).</p></dd>


</dl></li>
</ol></div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>In order to guess the intensity multiplication constant (please, refer to the <code>optim.params.init</code>
  argument), one might compare the intensities of the experimental (<code>expr</code>) and simulated (<code>sim</code>)
  EPR spectrum by one of the interactive or static plot functions (e.g. <code><a href="plot_EPR_Specs.html">plot_EPR_Specs</a></code>
  or <code><a href="plot_EPR_Specs2D_interact.html">plot_EPR_Specs2D_interact</a></code>) as well as by the <code><a href="eval_sim_EPR_iso.html">eval_sim_EPR_iso</a></code>. Accordingly,
  <strong>the initial intensity multiplication constant</strong> can be estimated as the ratio
  <strong>max(<code>expr</code> intensity)/max(<code>sim</code> intensity) * 0.25</strong>. The coefficient <code>0.25(1/4)</code> is
  introduced in order to be sure that both of the experimental and initially simulated EPR spectra,
  in the graphical output (see the <code>Value</code>), are clearly visible if <code>check.fit.plot = TRUE</code>.
  Otherwise, the spectra may overlay and it will be difficult to differentiate between them. Of course,
  any intensity multiplication coefficient, close to the experimental EPR intensity, can be applied as a starting
  point to evaluate the fit.</p>
<p>To fix one or more simulation parameter(s) (i.e. parameter(s) which is/are not optimized) during
  the fitting procedure, the corresponding <code>optim.parms.lower</code> as well as the <code>optim.params.upper</code> vector
  element(s) must equal to that of the <code>optim.params.init</code>. Please, refer to the <code>Examples</code> below
  for the simulation fit of aminoxyl radical EPR spectrum with bound constraints and fixed A(1 x 14N).
  An alternative selection of a non-optimized/fixed simulation parameter can be also done by using
  the <code>optim.params.fix.id</code> argument, which can be also applied to fix the simulation parameters when searching
  for the best fit by the <code><a href="eval_sim_EPR_isoFit_space.html">eval_sim_EPR_isoFit_space</a></code>. Therefore, the latter function argument just selects
  an element of the <code>optim.params.init</code> (by its corresponding index) and accordingly, the selected simulation
  parameter value won't be optimized.</p>
<p>A simple EPR spectrum analysis by interactive simulation using the <code><a href="plot_eval_ExpSim_app.html">plot_eval_ExpSim_app</a></code>
  may return an <code>.R</code> script/code snippet for the <strong>initial</strong> simulation <strong>fit</strong> and therefore
  the user does not have to write (or remember) the code required to run the <code>eval_sim_EPR_isoFit</code>.
  Rather, she/he can instantly and seamlessly analyze an isotropic EPR spectrum by optimizing the simulation parameters.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other Simulations and Optimization:
<code><a href="eval_ABIC_forFit.html">eval_ABIC_forFit()</a></code>,
<code><a href="eval_sim_EPR_iso.html">eval_sim_EPR_iso()</a></code>,
<code><a href="eval_sim_EPR_isoFit_space.html">eval_sim_EPR_isoFit_space()</a></code>,
<code><a href="eval_sim_EPR_iso_combo.html">eval_sim_EPR_iso_combo()</a></code>,
<code><a href="optim_for_EPR_fitness.html">optim_for_EPR_fitness()</a></code>,
<code><a href="plot_eval_EPRtheo_mltiplet.html">plot_eval_EPRtheo_mltiplet()</a></code>,
<code><a href="plot_eval_RA_forFit.html">plot_eval_RA_forFit()</a></code>,
<code><a href="quantify_EPR_Sim_series.html">quantify_EPR_Sim_series()</a></code>,
<code><a href="smooth_EPR_Spec_by_npreg.html">smooth_EPR_Spec_by_npreg()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## loading built-in example dataset which is simple</span></span></span>
<span class="r-in"><span><span class="co">## EPR spectrum of the aminoxyl radical:</span></span></span>
<span class="r-in"><span><span class="va">aminoxyl.data.path</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="load_data_example.html">load_data_example</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"Aminoxyl_radical_a.txt"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">aminoxyl.data</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="readEPR_Exp_Specs.html">readEPR_Exp_Specs</a></span><span class="op">(</span><span class="va">aminoxyl.data.path</span>,</span></span>
<span class="r-in"><span>                    qValue <span class="op">=</span> <span class="fl">2100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## EPR spectrum simulation fit with "Nelder-Mead"</span></span></span>
<span class="r-in"><span><span class="co">## optimization method with `check.fit.plot = FALSE`:</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.a</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu">eval_sim_EPR_isoFit</span><span class="op">(</span>data.spectr.expr <span class="op">=</span> <span class="va">aminoxyl.data</span>,</span></span>
<span class="r-in"><span>    nu.GHz <span class="op">=</span> <span class="fl">9.806769</span>,</span></span>
<span class="r-in"><span>    lineG.content <span class="op">=</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>    optim.method <span class="op">=</span> <span class="st">"neldermead"</span>,</span></span>
<span class="r-in"><span>    nuclear.system.noA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"14N"</span>,<span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    baseline.correct <span class="op">=</span> <span class="st">"linear"</span>,</span></span>
<span class="r-in"><span>    optim.params.init <span class="op">=</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.006</span>, <span class="co"># g-value</span></span></span>
<span class="r-in"><span>        <span class="fl">4.8</span>, <span class="co"># G Delta Bpp</span></span></span>
<span class="r-in"><span>        <span class="fl">4.8</span>, <span class="co"># L Delta Bpp</span></span></span>
<span class="r-in"><span>        <span class="fl">0</span>, <span class="co"># intercept (constant) lin. baseline</span></span></span>
<span class="r-in"><span>        <span class="fl">0.018</span>, <span class="co"># Sim. intensity multiply</span></span></span>
<span class="r-in"><span>        <span class="fl">1e-6</span>, <span class="co"># slope lin. baseline</span></span></span>
<span class="r-in"><span>        <span class="fl">49</span><span class="op">)</span>, <span class="co"># A in MHz</span></span></span>
<span class="r-in"><span>    check.fit.plot <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>    msg.optim.progress <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## OUTPUTS:</span></span></span>
<span class="r-in"><span><span class="co">## best fit parameters:</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.a</span><span class="op">$</span><span class="va">best.fit.params</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  2.0059448e+00  5.4974114e+00  5.1862704e+00 -9.4929049e-05  1.8070618e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6]  2.7243216e-08  5.1351972e+01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## spectrum plot with experimental spectrum,</span></span></span>
<span class="r-in"><span><span class="co">## simulated one with the linear baseline fit</span></span></span>
<span class="r-in"><span><span class="co">## and simulated one with the linear baseline</span></span></span>
<span class="r-in"><span><span class="co">## fit subtracted:</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.a</span><span class="op">$</span><span class="va">plot</span></span></span>
<span class="r-plt img"><img src="eval_sim_EPR_isoFit-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## minimum sum of residual squares:</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.a</span><span class="op">$</span><span class="va">min.rss</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 3.3805427e-07</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## number of evaluations / iterations:</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.a</span><span class="op">$</span><span class="va">N.evals</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 512</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## convergence, in this case it is represented</span></span></span>
<span class="r-in"><span><span class="co">## by the integer code indicating the successful</span></span></span>
<span class="r-in"><span><span class="co">## completion (it must be &gt; 0):</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.a</span><span class="op">$</span><span class="va">N.converg</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## preview of data frame including all EPR spectra:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">tempo.test.sim.fit.a</span><span class="op">$</span><span class="va">df</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          B_G     Experiment     Simulation     Residuals Simulation_NoBasLin</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        &lt;num&gt;          &lt;num&gt;          &lt;num&gt;         &lt;num&gt;               &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1: 3332.7000 -1.7738564e-06 -4.1290221e-06 2.3551657e-06       6.5629077e-09</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2: 3332.9005  1.2209461e-07 -4.1235480e-06 4.2456426e-06       6.5756338e-09</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3: 3333.1009 -1.8403788e-07 -4.1180464e-06 3.9340085e-06       6.6158641e-09</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4: 3333.3014 -7.1641412e-08 -4.1125720e-06 4.0409306e-06       6.6288572e-09</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5: 3333.5019 -1.7361444e-06 -4.1070702e-06 2.3709258e-06       6.6693576e-09</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6: 3333.7023 -5.1531169e-07 -4.1015956e-06 3.5862839e-06       6.6826214e-09</span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## similar EPR spectrum simulation fit with "particle swarm"</span></span></span>
<span class="r-in"><span><span class="co">## optimization algorithm and `check.fit.plot = TRUE` option</span></span></span>
<span class="r-in"><span><span class="co">## as well as user defined bound constraints, including</span></span></span>
<span class="r-in"><span><span class="co">## fixed A(1 x 14N) = 52.6 MHz:</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.b</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu">eval_sim_EPR_isoFit</span><span class="op">(</span>data.spectr.expr <span class="op">=</span> <span class="va">aminoxyl.data</span>,</span></span>
<span class="r-in"><span>    nu.GHz <span class="op">=</span> <span class="fl">9.806769</span>,</span></span>
<span class="r-in"><span>    lineG.content <span class="op">=</span> <span class="fl">0.75</span>,</span></span>
<span class="r-in"><span>    optim.method <span class="op">=</span> <span class="st">"pswarm"</span>,</span></span>
<span class="r-in"><span>    nuclear.system.noA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"14N"</span>,<span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    baseline.correct <span class="op">=</span> <span class="st">"constant"</span>,</span></span>
<span class="r-in"><span>    optim.params.init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.0062</span>,<span class="fl">4.8</span>,<span class="fl">4.8</span>,<span class="fl">0</span>,<span class="fl">8e-3</span>,<span class="fl">52.68</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    optim.params.lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.0048</span>,<span class="fl">4.6</span>,<span class="fl">4.6</span>,<span class="op">-</span><span class="fl">1e-4</span>,<span class="fl">5e-3</span>,<span class="fl">52.68</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    optim.params.upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.0068</span>,<span class="fl">5.0</span>,<span class="fl">5.0</span>,<span class="fl">1e-4</span>,<span class="fl">1.5e-2</span>,<span class="fl">52.68</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    check.fit.plot <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>    eval.optim.progress <span class="op">=</span> <span class="cn">TRUE</span> <span class="co">## iterations, progress</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  EPR simulation parameters are currently being optimized by   PSWARM ;  method   1   of   1 ... </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> S=14, K=6, p=0.359, w0=0.7213, w1=0.7213, c.p=1.193, c.g=1.193</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> v.max=NA, d=0.5658, vectorize=FALSE, hybrid=off</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> It 10: fitness=3.689e-08, swarm diam.=0.3786</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> It 20: fitness=1.547e-08, swarm diam.=0.1343</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> It 30: fitness=1.512e-08, swarm diam.=0.02264</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Maximal number of function evaluations reached</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Done!  ( 100  %)    elapsed time  12.331  s </span>
<span class="r-in"><span><span class="co">## OUTPUTS:</span></span></span>
<span class="r-in"><span><span class="co">## minimum sum of residual squares:</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.b</span><span class="op">$</span><span class="va">min.rss</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.5111436e-08</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## check and compare the previous value</span></span></span>
<span class="r-in"><span><span class="co">## by residual analysis (`ra`)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">tempo.test.sim.fit.b</span><span class="op">$</span><span class="va">ra</span><span class="op">$</span><span class="va">df</span><span class="op">$</span><span class="va">Residuals</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.5111436e-08</span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## number of evaluations / iterations:</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.b</span><span class="op">$</span><span class="va">N.evals</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  function iteration  restarts </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       512        37         0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## best fit parameters:</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.b</span><span class="op">$</span><span class="va">best.fit.params</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  2.0053180e+00  5.0000000e+00  4.6040587e+00 -1.2496262e-08  1.2755818e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6]  5.2680000e+01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## correlation matrix of the EPR simulation fit:</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.b</span><span class="op">$</span><span class="va">cor.df</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Experiment   Simulation    Residuals</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Experiment 1.00000000 0.9955977007 0.1027449140</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Simulation 0.99559770 1.0000000000 0.0090591452</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residuals  0.10274491 0.0090591452 1.0000000000</span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## visualization of the previous matrix:</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.b</span><span class="op">$</span><span class="va">cor.df</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">corrplot</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html" class="external-link">corrplot</a></span><span class="op">(</span>addCoef.col <span class="op">=</span> <span class="st">"#c2c2c2"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="eval_sim_EPR_isoFit-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## quick simulation check by plotting the both</span></span></span>
<span class="r-in"><span><span class="co">## simulated and the experimental EPR spectra</span></span></span>
<span class="r-in"><span><span class="co">## together with the initial simulation</span></span></span>
<span class="r-in"><span><span class="co">## and the residuals (differences between the</span></span></span>
<span class="r-in"><span><span class="co">## experiment and the best fit)</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.b</span><span class="op">$</span><span class="va">plot</span></span></span>
<span class="r-plt img"><img src="eval_sim_EPR_isoFit-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## simple residual density plot</span></span></span>
<span class="r-in"><span><span class="co">## together with standard deviation</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.b</span><span class="op">$</span><span class="va">ra</span><span class="op">$</span><span class="va">plot.histDens</span></span></span>
<span class="r-plt img"><img src="eval_sim_EPR_isoFit-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.b</span><span class="op">$</span><span class="va">ra</span><span class="op">$</span><span class="va">sd</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 3.1814343e-06</span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## Akaike and Bayesian Criteria (AIC &amp; BIC)</span></span></span>
<span class="r-in"><span><span class="co">## + information about the residuals distribution</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.b</span><span class="op">$</span><span class="va">abic</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $abic.vec</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -33994.251 -33962.428</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $message</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Information criteria evaluated using the"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2] "Student's t-distribution of residuals with 6"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3] "degrees of freedom. Additionally supported"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4] "by the Shapiro-Wilk as well as by the"       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5] "Kolmogorov-Smirnov tests."                   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## residual &amp; Q-Q plots for the proposed normal</span></span></span>
<span class="r-in"><span><span class="co">## distribution of residuals and confidence level 99%</span></span></span>
<span class="r-in"><span><span class="co">## (default: 95%/0.95)</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.b</span><span class="op">$</span><span class="va">ra</span><span class="op">$</span><span class="fu">plot.rqq</span><span class="op">(</span>confidence <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `geom_smooth()` using method = 'gam' and formula = 'y ~ s(x, bs = "cs")'</span>
<span class="r-plt img"><img src="eval_sim_EPR_isoFit-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## residual &amp; Q-Q plots for the proposed Student's</span></span></span>
<span class="r-in"><span><span class="co">## distribution of residuals with degrees of freedom</span></span></span>
<span class="r-in"><span><span class="co">## df = 6 (see the "$message" right above)</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.b</span><span class="op">$</span><span class="va">ra</span><span class="op">$</span><span class="fu">plot.rqq</span><span class="op">(</span></span></span>
<span class="r-in"><span>  residuals.distro <span class="op">=</span> <span class="st">"t"</span>,</span></span>
<span class="r-in"><span>  df <span class="op">=</span> <span class="fl">6</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `geom_smooth()` using method = 'gam' and formula = 'y ~ s(x, bs = "cs")'</span>
<span class="r-plt img"><img src="eval_sim_EPR_isoFit-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## fitting of the aminoxyl EPR spectrum</span></span></span>
<span class="r-in"><span><span class="co">## by the combination of the 1. "Levenberg-Marquardt"</span></span></span>
<span class="r-in"><span><span class="co">## and 2. "Nelder-Mead" algorithms</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.c</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu">eval_sim_EPR_isoFit</span><span class="op">(</span><span class="va">aminoxyl.data</span>,</span></span>
<span class="r-in"><span>                      nu.GHz <span class="op">=</span> <span class="fl">9.86769</span>,</span></span>
<span class="r-in"><span>                      lineG.content <span class="op">=</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>                      optim.method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"levenmarq"</span>,</span></span>
<span class="r-in"><span>                                       <span class="st">"neldermead"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                      nuclear.system.noA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"14N"</span>,<span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                      baseline.correct <span class="op">=</span> <span class="st">"constant"</span>,</span></span>
<span class="r-in"><span>                      optim.params.init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.0060</span>,</span></span>
<span class="r-in"><span>                                            <span class="fl">4.8</span>,</span></span>
<span class="r-in"><span>                                            <span class="fl">4.8</span>,</span></span>
<span class="r-in"><span>                                            <span class="fl">0</span>,</span></span>
<span class="r-in"><span>                                            <span class="fl">7e-3</span>,</span></span>
<span class="r-in"><span>                                            <span class="fl">49</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                      check.fit.plot <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span>                    <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  EPR simulation parameters are currently being optimized by   LEVENMARQ ;  method   1   of   2 ... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Done!  ( 50  %)    elapsed time  0.765  s </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  EPR simulation parameters are currently being optimized by   NELDERMEAD ;  method   2   of   2 ... ... </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Done!  ( 100  %)    elapsed time  9.947  s </span>
<span class="r-in"><span><span class="co">## OUTPUTS:</span></span></span>
<span class="r-in"><span><span class="co">## best fit parameters for both procedures within a list:</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.c</span><span class="op">$</span><span class="va">best.fit.params</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  2.0060000e+00  5.7600000e+00  5.7600000e+00 -8.8971218e-10  6.4310899e-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6]  4.9000000e+01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  2.0069998e+00  4.8414135e+00  3.8400904e+00 -7.6354747e-10  8.7499998e-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6]  5.3612538e+01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## compare the results with the example in the `readMAT_params_file`,</span></span></span>
<span class="r-in"><span><span class="co">## corresponding to the best fit from `Easyspin`</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## `N.converg` also consists of two components</span></span></span>
<span class="r-in"><span><span class="co">## each corresponding to result of the individual</span></span></span>
<span class="r-in"><span><span class="co">## optimization method where the "levenmarq" returns</span></span></span>
<span class="r-in"><span><span class="co">## the sum of squares at each iteration, therefore the 1st</span></span></span>
<span class="r-in"><span><span class="co">## component is vector and the 2nd one is integer code</span></span></span>
<span class="r-in"><span><span class="co">## as already stated above:</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.c</span><span class="op">$</span><span class="va">N.converg</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.6573191e-06 1.5727024e-06 1.5529724e-06 1.5518805e-06 1.5518805e-06</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## Akaike and Bayesian Criteria (AIC &amp; BIC)</span></span></span>
<span class="r-in"><span><span class="co">## + information about the residuals distribution</span></span></span>
<span class="r-in"><span><span class="va">tempo.test.sim.fit.c</span><span class="op">$</span><span class="va">abic</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $abic.vec</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -27866.025 -27834.202</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $message</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Information criteria evaluated using the"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2] "Student's t-distribution of residuals with 4"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3] "degrees of freedom. Additionally supported"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4] "by the Shapiro-Wilk as well as by the"       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5] "Kolmogorov-Smirnov tests."                   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ján Tarábek.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

